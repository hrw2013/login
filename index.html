<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Login / Signup (Firebase)</title>
<style>
body{font-family:system-ui;background:#0f1724;color:#fff;display:flex;justify-content:center;align-items:center;min-height:100vh;margin:0}
.container{width:100%;max-width:400px;padding:24px;background:#111827;border-radius:10px;box-shadow:0 0 20px rgba(0,0,0,0.4)}
input,button{width:100%;padding:10px;margin-top:8px;border-radius:6px;border:none}
input{background:#1e293b;color:white}
button{background:#06b6d4;color:#000;font-weight:600;cursor:pointer}
.small{color:#94a3b8;font-size:14px;text-align:center;margin-top:8px;cursor:pointer}
#user-dashboard{display:none;}
#messages{margin-top:10px;padding:10px;background:#1e293b;border-radius:6px;display:none;}
</style>
</head>
<body>
<div class="container">
  <div id="forms">
    <h2 id="form-title">Sign Up</h2>
    <form id="signup-form">
      <input id="s-name" placeholder="Full name" required />
      <input id="s-email" type="email" placeholder="Email" required />
      <input id="s-pass" type="password" placeholder="Password" required />
      <button type="submit">Sign Up</button>
    </form>
    <form id="login-form" style="display:none">
      <input id="l-email" type="email" placeholder="Email" required />
      <input id="l-pass" type="password" placeholder="Password" required />
      <button type="submit">Login</button>
    </form>
    <div class="small" id="switch-form">Already have an account? Login</div>
    <div class="small">Admin? <a href="admin.html" style="color:#06b6d4">Go to dashboard</a></div>
  </div>

  <div id="user-dashboard">
    <h2>Welcome, <span id="user-name"></span></h2>
    <p>Email: <span id="user-email"></span></p>
    <button id="view-messages">View My Messages</button>
    <div id="messages"></div>
    <button id="logout">Logout</button>
  </div>
</div>

<!-- Firebase SDKs -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";
import { 
  getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, 
  signOut, onAuthStateChanged, updateProfile 
} from "https://www.gstatic.com/firebasejs/11.0.0/firebase-auth.js";
import { 
  getFirestore, doc, setDoc, getDoc 
} from "https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";

// ✅ Your Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyA10rt9j5WUTp8-T0i7qcpWp1uIu3oI_Wc",
  authDomain: "login-dashboard-4aa87.firebaseapp.com",
  projectId: "login-dashboard-4aa87",
  storageBucket: "login-dashboard-4aa87.firebasestorage.app",
  messagingSenderId: "196276515757",
  appId: "1:196276515757:web:c8420101386483f40de724",
  measurementId: "G-LBEHKCTYLF"
};

// ✅ Initialize Firebase
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const ADMIN_EMAIL = "harrisonrobertwoods@gmail.com";
const $ = id => document.getElementById(id);

function showLogin() {
  $('signup-form').style.display='none';
  $('login-form').style.display='block';
  $('form-title').innerText='Login';
  $('switch-form').innerText='Need an account? Sign up';
}
function showSignup() {
  $('signup-form').style.display='block';
  $('login-form').style.display='none';
  $('form-title').innerText='Sign Up';
  $('switch-form').innerText='Already have an account? Login';
}
$('switch-form').onclick = () =>
  ($('signup-form').style.display==='none' ? showSignup() : showLogin());

// ✅ Signup
$('signup-form').addEventListener('submit', async e => {
  e.preventDefault();
  const name = $('s-name').value.trim();
  const email = $('s-email').value.trim();
  const pass = $('s-pass').value;
  try {
    const cred = await createUserWithEmailAndPassword(auth, email, pass);
    await updateProfile(cred.user, { displayName: name });
    await setDoc(doc(db, "users", cred.user.uid), { name, email });
    alert('Account created!');
  } catch (err) { alert(err.message); }
});

// ✅ Login
$('login-form').addEventListener('submit', async e => {
  e.preventDefault();
  const email = $('l-email').value.trim();
  const pass = $('l-pass').value;
  try {
    await signInWithEmailAndPassword(auth, email, pass);
  } catch (err) { alert(err.message); }
});

// ✅ Auth State Handling
onAuthStateChanged(auth, async user => {
  if (user) {
    if (user.email === ADMIN_EMAIL) { 
      location.href = 'admin.html'; 
      return; 
    }
    $('forms').style.display = 'none';
    $('user-dashboard').style.display = 'block';
    $('user-name').innerText = user.displayName || 'User';
    $('user-email').innerText = user.email;
  } else {
    $('forms').style.display = 'block';
    $('user-dashboard').style.display = 'none';
  }
});

// ✅ View Messages
$('view-messages').onclick = async () => {
  const user = auth.currentUser;
  if (!user) return;
  const msgDoc = await getDoc(doc(db, "messages", user.uid));
  $('messages').innerText = msgDoc.exists() ? msgDoc.data().text : "No messages from admin yet.";
  $('messages').style.display = 'block';
};

// ✅ Logout
$('logout').onclick = () => signOut(auth);
</script>
</body>
</html>
